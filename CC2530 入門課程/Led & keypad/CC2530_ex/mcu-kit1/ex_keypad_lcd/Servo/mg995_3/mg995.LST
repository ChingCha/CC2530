C51 COMPILER V8.08   MG995                                                                 04/02/2010 13:02:08 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE MG995
OBJECT MODULE PLACED IN mg995.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE mg995.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************
   2          
   3          上面就是簡單的3個按鈕,
   4          1個按下去會讓SERVO置中 , 送PWM:1.5ms
   5          1個按下去會讓SERVO的目前PWM減小0.1ms 模擬往左轉, 最小到0.5ms就不動了
   6          1個按下去會讓SERVO的目前PWM增加0.1ms 模擬往右轉, 最大到2.5ms就不動了
   7          
   8          
   9          SERVO的電流和版子的電流分開供應
  10          第一次開機要先按置中的按鈕之後才能按其他2顆按鈕
  11          
  12          **********************************************************************/
  13          #include <regx51.h>
  14          unsigned int dutytime=45536; //65536-45536就是責任週期
  15          unsigned int ton=10000; //高電位比例=50%
  16          unsigned int toff=10000; //低電位比例=50%
  17          unsigned int temp; //給計時器工作用
  18          unsigned int presscount; //按下計時用
  19          void delay(unsigned int b)
  20          {
  21   1              unsigned int x;
  22   1              for(x=0;x<b;x++);
  23   1      }
  24          void timer0_initialize(void)  //初始化計時器0
  25          {
  26   1          EA=0; //關閉中斷功能(所有中斷副程式失效)
  27   1          IE|=0x02; //開啟計時器中斷功能
  28   1          TMOD|=0x01; //設定計時器模式
  29   1          temp=65536-dutytime; //設定中斷一次的時間(預設是dutytime)
  30   1          TH0=temp/256; //填入高八位
  31   1          TL0=temp%256; //填入低八位
  32   1          TR0=1; //啟動計時器
  33   1          EA=1; //開啟中斷功能(中斷副程式可以執行)
  34   1      }
  35          void timer0_isr(void) interrupt TF0_VECTOR using 1 //使用計時器中斷副程式產生PWM
  36          {
  37   1          toff=20000-ton;
  38   1              if(P2_0==1)
  39   1          {
  40   2          TR0=0;
  41   2          temp=65536-toff;
  42   2          TH0=temp/256;
  43   2          TL0=temp%256;
  44   2          TR0=1;
  45   2          P2_0=0;
  46   2          }
  47   1          else
  48   1          {
  49   2          TR0=0;
  50   2          temp=65536-ton;
  51   2          TH0=temp/256;
  52   2          TL0=temp%256;
  53   2          TR0=1;
  54   2          P2_0=1;
  55   2          }
C51 COMPILER V8.08   MG995                                                                 04/02/2010 13:02:08 PAGE 2   

  56   1      }
  57          void main(void) //主程式開始
  58          {
  59   1          timer0_initialize(); //呼叫計時器初始化副程式
  60   1          //主程式中可直接改變ton或toff即可改變高電位跟低電位佔的比例
  61   1          while(1)
  62   1              {
  63   2                      if(P1_0==0)
  64   2                      {
  65   3                              while(P1_0==0)   //按下不動作,放開才動作
  66   3                              {
  67   4                                      if(presscount<30000)presscount++;  //按住一段時間後開始每0.5秒轉0.1ms直到2.5ms
  68   4                                      if(presscount==30000&&ton<2500) 
  69   4                                      {
  70   5                                              ton=ton+100; 
  71   5                                              delay(20000);
  72   5                                      }
  73   4                              }
  74   3                              if(ton<2500)ton=ton+100;
  75   3                              presscount=0;
  76   3                      }
  77   2                      if(P1_1==0)ton=1500;            //按一次轉回中間1.5ms
  78   2                      if(P1_2==0)
  79   2                      {                                                         
  80   3                              while(P1_2==0)   //按下不動作,放開才動作
  81   3                              {
  82   4                                      if(presscount<30000)presscount++;  //按住一段時間後開始每0.5秒轉0.1ms直到2.5ms
  83   4                                      if(presscount==30000&&ton>500) 
  84   4                                      {
  85   5                                              ton=ton-100; 
  86   5                                              delay(20000);
  87   5                                      }
  88   4                              }
  89   3                              if(ton>500)ton=ton-100;
  90   3                              presscount=0;
  91   3                      }
  92   2              }
  93   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    313    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
